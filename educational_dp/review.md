# [Educational DP Contest / DP まとめコンテスト](https://atcoder.jp/contests/dp) Review

## A - Frog 1
- $\mathrm{dp}_i: $ 足場 $1$ から $i$ まで行くのに必要なコストの総和の最小値
- 1要素のベーシックなDP
- 時間 $O(N)$ 、空間 $O(N)$

## B - Frog 2
- $\mathrm{dp}_i: $ 足場 $1$ から $i$ まで行くのに必要なコストの総和の最小値
- A問題との差は遷移先が2つから $K$ 個に増えただけ
- 時間 $O(NK)$ 、空間 $O(N)$

## C - Vacation
- $\mathrm{dp}_{i,j}: $ $i$ 日目にした行動が $j$ のときの、初日から $i$ 日目までに得られる幸福度の最大値
- $\mathrm{dp}_{i,j}$ から $\mathrm{dp}_{i+1,j}$ への遷移を禁じればOK
- 行動の種類数を $M$ として 時間 $O(NM)$ 、空間 $O(NM)$

## D - Knapsack 1
- $\mathrm{dp}_{i,j}: $ $i$ 番目までのナップサックからいくつか選んで重さの総和が $j$ になるときにあり得る価値の総和の最大値
- 典型的なナップサック問題
- 時間 $O(NW)$ 、空間 $O(NW)$

## E - Knapsack 2
- $\mathrm{dp}_{i,j}: $ $i$ 番目までのナップサックからいくつか選んで価値の総和が $j$ になるときにあり得る重さの総和の最小値
- $O(NW)$ が`TLE`する典型的パターン
- $\max_i v_i = V$ として時間 $O(N^2V)$ 、空間 $O(N^2V)$

## F - LCS
- 恐らく題意として意図されたものはDP復元だよなぁと思いつつも、時間計算量が間に合いそうだったので文字列そのものを保持するDPでやってみた
  - 流石に文字列のコピーが何度も発生するので速くはないが1162msで通った
- $\mathrm{dp}_i: $ 題意を満たすような文字列で $t_i$ を末尾とするもののうち最長のもの
- $i = 1, 2, \dots, |s|$ の順に以下のように遷移する
  - $j = |t|, |t|-1, \dots, 1, 0$ の順に以下を行う
    - $t_k = s_i$ を満たす最小の $k > j$ が存在すれば、
      - $X = \mathrm{dp}_j + s_i$ とし、 $|X| > |\mathrm{dp}_{k}|$ ならば $\mathrm{dp}_{k} \gets X$
    - あらかじめ $t_i = c$ となる $i$ の集合 $T_c$ を用意しておくことで $k$ を $O(\log |t|)$ で求められる
    - in-placeなDPなので、 $j$ を逆順で更新することにより一度更新したものをもう一度更新してしまうことを防ぐ必要がある
- 時間 $O(|s||t| \log |t|)$ 、空間 $O(|s||t|)$

## G - Longest Path
- 有向閉路が存在しない、すなわちDAG
  - よってトポロジカルソートを行い頂点番号を振り直しておく
- $\mathrm{dp}_i: $ 頂点 $i$ を終端とするパスの長さの最大値
- $i = 1, 2, \dots, N$ の順に以下のように遷移する
  - $i$ と隣接する頂点 $j$ に対し、 $\mathrm{dp}_j \gets \max \{ \mathrm{dp}_j, \mathrm{dp}_i + 1 \}$
- in-placeなDPだが配るDPで更新することで更新順を固定できる
- 時間 $O(N+M)$ 、空間 $O(N)$
- （公式解説）メモ化DPにすれば明示的なトポロジカルソートは不要

## H - Grid 1
- $\mathrm{dp}_{i,j}: $ $(1,1)$ から $(H,W)$ へ移動する方法の場合の数
- 初期値 $\mathrm{dp}_{1,1} = 1$ として、遷移先（ $(i, j+1), (i+1, j)$ ）が壁でなければ $\mathrm{dp}_{i,j}$ を加える
- 時間 $O(HW)$ 、空間 $O(HW)$

## I - Coins
- $\mathrm{dp}_{i,j}: $ コイン $1$ から $i$ までを投げて出た表の枚数が $j$ になる確率
- 初期値 $\mathrm{dp}_{0,0} = 1$ として以下のように遷移する
  - $\mathrm{dp}_{i, j} \gets (1 - p_i) \mathrm{dp}_{i-1, j}$
  - $\mathrm{dp}_{i, j} \gets p_i \mathrm{dp}_{i-1, j-1}$
- 時間 $O(N^2)$ 、空間 $O(N^2)$

## J - Sushi
- $\mathrm{dp}_{i,j,k}: $ 寿司が3個、2個、1個乗った皿がそれぞれ $i,j,k$ 枚あるとき、これらの寿司を全て食べるまでにサイコロを振る回数の期待値
- $\mathrm{dp}_{i,j,k} = 1 + \frac{i}{N} \mathrm{dp}_{i-1,j+1,k} + \frac{j}{N} \mathrm{dp}_{i,j-1,k+1} + \frac{k}{N} \mathrm{dp}_{i,j,k-1}$
  - ただし $i = 0$ なら $\mathrm{dp}_{i-1,j+1,k}$ を、 $j = 0$ なら $\mathrm{dp}_{i,j-1,k+1}$ を、 $k = 0$ なら $\mathrm{dp}_{i,j,k-1}$ をそれぞれ $\mathrm{dp}_{i,j,k}$ に置き換える（もう寿司が無いので食べられず現状と変わらない）
    - 両辺に $\mathrm{dp}_{i,j,k}$ が存在するので移項が必要となる
- 時間 $O(N^3)$ 、空間 $O(N^3)$

## K - Stones
- ネガマックス法
- $\mathrm{dp}_{i}: $ 山にある石が $i$ 個の状態からスタートしたとき、先攻と後攻のどちらが勝つか
- メモ化DPで再帰しながら探索したが、手元の環境では $a_i$ が小さく $K$ が大きいときに異常終了した
  - 再帰によるスタックオーバーフローが原因と思われる
- 今回は $0 \leq j < i$ を満たす全ての $j$ に対して $\mathrm{dp}_{j}$ が求まっていれば $\mathrm{dp}_{i}$ を求められるので、素直に $i = 0, 1, \dots, N$ の順に探索することにした
- 時間 $O(N \log N + NK)$ 、空間 $O(K)$

## L - Deque
- ネガマックス法
- $\mathrm{dp}_{i,j}: $ 次に取ることのできる先頭要素が（元の $a$ において）第 $i$ 項、末尾要素が第 $j$ 項である状況からゲームを始めて双方が最善を尽くしたときの先攻プレイヤーの点数から後攻プレイヤーの点数を引いた値
- メモ化DPで探索
  - 今回のように $i > N, j < 1$ などの**添字が範囲外になる可能性があるときは、メモを見るより先に終了条件をチェックすべし**
- 時間 $O(N^2)$ 、空間 $O(N^2)$

## M - Candies
- $\mathrm{dp}_{i,j}: $ $i$ 人目までに合計 $j$ 個の飴を配る場合の数
- **配るDPが大変なときは貰うDPを考えるべし**
  - 配るDPだと範囲更新が必要になるが、貰うDPだと1点更新で済む
- いずれにしても範囲加算は必要になるので`atcoder::fenwicktree`に任せた
- 時間 $O(NK \log K)$ 、空間 $O(NK)$


## O - Matching
- $\mathrm{dp}_{i,S}: $ 男性の $i$ 人目まで見てすでにペアになった女性の集合が $S$ になるようなペアの作り方の場合の数としてやると $O(N^2 2^N)$ で`TLE`……だったのだが
  - 男性とペアになる女性の候補を絞るときに「 $S$ に女性 $j$ が含まれていない」 「 $a_{i,j} = 1$ 」 のうち、1つ目の条件を先にすると確かに`TLE`になるのだが
    - テストケースが甘く、2つ目の条件を先にすると $O(N^2 2^N)$ でも820msで通ってしまう
- 勿論実際にはもっと計算量を減らせる解放があり、 $i = \mathrm{popcount}(S)$ (0-indexed) とできるのでそもそも要素 $i$ をDPに入れなくてよい
  - bit DPは $S$ から $S \cup T$ への遷移を行うが、このとき $f(S)$ を集合 $S$ を表す整数とすると $f(S) < f(S \cup T)$ を必ず満たすので**単に昇順で更新すればよい**
    - 非負整数列の昇順がそのままトポロジカルソートになっているとも言い換えられる
  - すなわち $\mathrm{dp}_{S}: $ 集合 $S$ に含まれる女性全員がいずれかの男性とペアになるような場合の数でOK
- 時間 $O(N2^N)$ 、空間 $O(2^N)$

