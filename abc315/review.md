# ABC315 Review
- Rated参加
- **遂に水色到達！**
  - 長かったぜ…

## A - tcdr
- AC
- C言語系の`switch`文なんて久々に書いたな…

## B - The Middle Day
- AC
- 丁寧に引き算をしていくだけの簡単なお仕事
  - 出力時に+1を忘れずに

## C - Flavors
- AC
- 2つのカップが同じ味のときの最大値と異なる味のときの最大値を比べる方針で
- 自分の解法：$O(N \log N)$
    1. カップを $S_i$ が大きい順に並び変える
    - 以下添え字はソート後のものを表す
    1. $F_1 \neq F_2$ ならば間違いなく満足度最大なので $S_1 + S_2$ を出力する
    1. $F_1 = F_2$ のとき、$F_1 \neq F_i$ を満たす $i$ に対して $S_1 + S_2 / 2$ と $S_1 + S_i$ の大きいほうを出力する
        - 上記を満たす $i$ が存在しないときは $S_1 + S_2 / 2$ を出力する
- ソートせずに $O(N)$ でも解けるはずだがまぁ書きやすさを優先したので…

## D - Magical Cookies
- TLEからの時間切れ
  - コードは終了後に提出したもの
- 愚直に操作して`TLE`を喰らう
  - `WA`でなかっただけマシか…
- 行主体の管理、列主体の管理、いずれも計算量を減らせるやりかたが思いつかず
  - 文字種主体の管理は一瞬考えたものの、行or列のすべてが同じ文字かの判定が結局 $\Theta(W), \Theta(H)$ になるよなぁと考えて却下したが
    - （公式解説を見て）**$\Theta(1)$ の方法あるやんけ！**
- 書いたコードはほぼ公式解説の通りなので説明は割愛

## E - Prerequisites
- AC
- DAGおよびトポロジカルソートをすぐに思い出せたのは良かった
- $P_{i,j}$ から $i$ へ辺を張る方針で実装中に、必要のない本を除けるなら逆に辺を張ったほうが楽なことに気づくものの
  - トポロジカルソートの部分をいじるのが怖かったので、別途辺を逆に張ったグラフを用意して必要のない本を除けることにした
- 自分の解法：$O(N + \sum_{i = 1}^{N} C_i)$
    1. すべての $i$ および $1 \leq j \leq C_i$ に対し、$P_{i,j}$ から $i$ へ向かう向きの辺を張った有向グラフ $G$ を作る
    1. $G$ のすべての辺を逆にした有向グラフ $G'$ を作る
    1. $G'$ の頂点 $1$ を根とするDFSを行い、到達できなかった頂点列 $V$ を記録する
    1. $G$ の全頂点に対してトポロジカルソートを行う
    1. ↑から $V$ に含まれる頂点および頂点 $1$ を削除したものを順に出力する

## F - Shortcuts
- AC (1WA)
- チェックポイントを $1, 2, \dots , N$ の順に通るレースと聞いて思わずオリエンテーリングを想起してテンションが上がる
  - そしてチェックポイントを省略できると聞いてテンションが下がる
    - ※オリエンテーリングは1つでもチェックポイントをスルーすると即失格
- パッと見でDPでいけそうと踏む
- $dp_{i,j}$ を、「チェックポイント $1$ から $i$ までを $j$ 個を通らずに来る場合の総移動距離の最小値」と定義
- チェックポイントは何個でもスルーできるので、一見すると $dp_{i,j}$ を更新するのに $j$ 回の計算が必要となり $O(N^3)$ で`TLE`になりそうだが、以下のことに気づく
  - 1回の移動距離は最大で $10^4 \sqrt{2} \approx 14142$ なのに対し、$C \geq 15$ において通らなかったチェックポイント1個に対するペナルティは $2^{14} = 16384$ 以上になる
    - すなわち15個以上をスルーするとむしろ逆効果となるので、$j \leq 15$ として問題ない
      - これで計算量も劇的に改善できる
      - 実際にはちょっと日和って $j \lt 20$ とした
- 浮動小数点による誤差？まぁ絶対誤差 or 相対誤差 $10^{-5}$ まで許されるし大丈夫やろ！（適当）
- 自分の解法：後述の $M$ を用いて $O(NM^2)$
    1. $M = \min \{ n, 20 \}$ とする
    1. 上述のDPを $dp_{i,j} = \min_{ \max \{i - 1, j - 1 \} \lt k \lt m} \{ dp_{i - k - 1, j - k} + \sqrt{(x_i - x_{i-k-1})^2 + (y_i - y_{i-k-1})^2} \}$ で更新する
    1. $\min_{0 \leq j \lt m} \{ dp_{N,j} + \lfloor 2^{j - 1} \rfloor \}$ を出力する
- ループを書き換えた際にループ終了条件を更新し忘れて1敗。気を付けよう

## G - Ai + Bj + Ck = X (1 <= i, j, k <= N)
- コードは終了後に提出したもの
- 一次不定方程式は大学入試数学でも頻出であるため、黄色問題でも食らいついてみる
- $i$ を全探索していつもの二元一次不定方程式に持ち込み、あとは定数時間か対数時間で $j, k$ を探索するようにすればOK
- 自分の解法：$O(N \log \min \{ B, C \})$
    1. 各 $i (1 \leq i \leq N)$ に対して以下を行う
        1. $Bj + Ck = X - Ai = Y$ とおく
        1. $Y$ が $\gcd(B, C)$ で割り切れない場合は解 $(i, j, k)$ が存在しないので次の $i$ へ
        1. $B, C, Y$ をそれぞれ $\gcd(B, C)$ で割って $B', C', Y'$ とする
        1. [拡張ユークリッド互除法](https://qiita.com/drken/items/b97ff231e43bce50199a)で $B'j + C'k = \gcd(B, C)$ を満たす解を1つ見つけ、$(j, k) = (j_0, k_0)$ とする
        1. このとき $Y'$ を $B'$ で割った商を $q$、余りを $r$ とすれば、$B'j + C'k = Y'$ を満たす解の1つとして $(j, k) = (rj_0 + q, rk_0)$ が得られる（これを $(j_1, k_1)$ とする）
        1. $B'j + C'k = Y'$ の一般解は $m$ を整数として $(j, k) = (C'm + j_1, -B'm + k_1)$ と表せる
        1. $1 \leq j \leq N, 1 \leq k \leq N$ を満たす $m$ の個数を数える
            - 具体的には $\lceil \frac{1 - j_1}{C'} \rceil \leq m \leq \lfloor \frac{n - j_1}{C'} \rfloor, \lceil \frac{k_1 - N}{B'} \rceil \leq m \leq \lfloor \frac{k_1 - 1}{B'} \rfloor, $ と変形できるので、これらの共通部分の左端の整数 $L_i$ と右端の整数 $R_i$ に対し、$R_i - L_i + 1$ が $m$ の個数となる
    1. ↑で数えた $m$ の個数を合計する
- ハマったポイント
  - $B, C, Y$ が2以上の公約数を持つ場合にそのまま互除法を行い1敗
    - $(j, k) = (C'm + j_1, -B'm + k_1)$ とはならないので以降の議論が滅茶苦茶になる
  - 大学入試数学では $(j, k) = (j_0, k_0)$ を見つけたらそれぞれを $Y'$ 倍して $(j_1, k_1)$ とするのが一般的な解き方だが、今回それをやるとオーバーフローが生じてさらに1敗
    - この部分は良い回避法が思いつかなかったので、公式解答をチラ見
      - 言われてみれば単純なことなんだがなぁ
      - そしてこの処理の仕方、そういえば[QuizKnockの動画（東大vs算数オリンピック！てか本来は小学生が解くんか…）](https://www.youtube.com/watch?v=17EJ6zowfgs&t=332s)で見たやつやんけ！
        - あとから気づいても遅い…
