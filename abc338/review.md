# [ABC338](https://atcoder.jp/contests/abc338) Review
- バーチャル参加
- Eまでを1時間弱でこなし660位程度
  - 今（ABC410）なら1000位かもしれんなぁ……
  - なおポカミスx2がなければ570位程度だった模様

## D - Island Tour
- AC（19分＋1RE）
- 橋 $i$ を封鎖することでツアーの長さがどれだけ長くなるか（＝ $A_i$ ）を記録すれば、解は $ (\text{橋が封鎖されていないときのツアーの長さ}) + \min A $
- $A_i$ の求め方を考える
  - 以下、橋 $k$ は橋 $k + N$ および $k - N$ と同一とする
  - 島 $X_j$ から $X_{j+1}$ に向かう際、時計回り・反時計回りに進んだ長さをそれぞれ $d_1, d_2$ とおくと
    - $d_1 < d_2$ のとき
      - 本来使いたい橋は区間 $[X_j, X_{j+1})$ であり、このうちどれが封鎖されても $d_2 - d_1$ だけ $A_i$ に寄与する
    - $d_1 < d_2$ のとき
      - 本来使いたい橋は区間 $[X_{j+1}, X_j)$ であり、このうちどれが封鎖されても $d_1 - d_2$ だけ $A_i$ に寄与する
    - $d_1 = d_2$ のとき
      - どの橋が封鎖されても長さが変化しないため $A_i$ に寄与しない
  - ↑は $j$ に対して独立なので、 $A_i$ ごとに和を取ればよい
- すなわち区間加算 $M-1$ 回ができれば問題ないので、imos法を用いて計算量は $O(N+M)$

## E - Chords
- AC（11分）
- なんか見たことのある問題なんだよなぁ……と思いつつ
  - あとで類題[ABC405 F - Chord Crossing](https://atcoder.jp/contests/abc405/tasks/abc405_f)を解いていたことに気づく
- $L_i = \min \{ A_i, B_i \}, R_i = \max \{ A_i, B_i \}$ とする
- 解は「任意の $i,j$ に対し、 $L_i < L_j < R_i < R_j$ となるものが存在すれば`Yes`、しなければ`No`」と言い換えられる
- 弦を $R_i$ の昇順に並べて順に見ていく。すなわち $i < j$ に対し
  - $R_i < R_j$ は自動的に満たされる
  - あとは $L_i < L_j < R_i$ を満たす $j$ が存在するかどうかだが、これは以下の手順でわかる
    - あらかじめ数列 $C_k$ を $L_i = k$ を満たす $i$ の個数で初期化しておく
    - $\sum_{k=L_i + 1}^{R_i - 1} C_k > 0$ なら $L_i < L_j < R_i$ を満たす $j$ が存在する
    - $\sum_{k=L_i + 1}^{R_i - 1} C_k = 0$ なら $C_{L_i}$ を $1$ 減らして次の $i$ に備える
- 1点更新と区間和取得ができればよいので、Fenwick treeに任せれば計算量は $O(N\ log N)$

## F - Negative Traveling Salesman
- 時間切れ
- 「訪れた頂点の集合」「最後に訪れた頂点」の2要素Bit DPであることには気付いたが`TLE`
  - 全頂点を訪れた後に負のウォークが存在する（かつ探索が長引く）場合に`TLE`になってしまう
    - $\mathrm{dp}_{S,i}$ から $\mathrm{dp}_{S,j}$ への遷移などが現れる
      - 訪れた頂点集合 $S$ が変わっておらず、最後に訪れた頂点 $i,j$ も特に大小関係など無いため計算回数が無駄に膨れ上がる可能性がある
    - 頂点や辺への探索回数で制限をかけられないかと考えたが、グラフの形次第でどうにもならない
- （公式解説）頂点の順列に対しその順に頂点を最小コストで辿るようなウォークが最適となりうる……らしい
  - 入力例3は $(4,3,1,2,5,1,2)$ の順で辿るのが最適解だが、これを $(4,3,1,5,2)$ の順で頂点を辿っていると考えればOK
    - 実際には訪れている頂点をまだ訪れていない判定にするというのはいかにも不思議だが、確かにこれだと $S$ が不変になる遷移を駆逐できる……
      - あるいは、辺を足しまくればウォークではなくハミルトン路にできるからそれで判定すればええやん、とも言いかえられるか
