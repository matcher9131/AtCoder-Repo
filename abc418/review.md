# [ABC418](https://atcoder.jp/contests/abc418) Review
- Rated参加
- 1時間ちょっとでEまで解くもFで撃沈
  - しかし520位付近と大健闘
    - Fがまさかの橙色だったので助かったらしい
  - 3連敗で溶かしたレートをほぼほぼ回収してレート1400台に復帰。もう1300台には戻りたくない！
- 流石にそろそろステータスコードネタは無いだろうと油断していたら
  - teapot…… お前が居たか……
- しかもいつもはステータスコードネタはA問題だけなのに
  - B問題を見て「お前もteapotなんかい！」と2度目の不意打ちを食らって
    - さらにF問題まで
      - 隙を逃さぬ三段構えにやられた

## D - XNOR Operation 
- AC（30分）
- `1`になる部分文字列の末尾に
  - `1`を足しても結果は`1`のまま
  - `0`を足したら結果は`0`になる
- `0`になる部分文字列の末尾に
  - `1`を足しても結果は`0`のまま
  - `0`を足したら結果は`1`になる
- よって $\mathrm{dp}_{0, i}, \mathrm{dp}_{1, i}$ を $T$ の $i$ 文字目を右端とする部分文字列のうち操作結果がそれぞれ`0`,`1`になるようなものの個数とすると
  - 初期値:
    - $\mathrm{dp}_{0, 1}: $ $T_1$ が`0`なら $1$ 、`1`なら $0$
    - $\mathrm{dp}_{1, 1}: $ $T_1$ が`1`なら $1$ 、`0`なら $0$
  - 遷移:
    - $T_i$ が`1`:
      - $i$ 文字目単独の結果も含めて $\mathrm{dp}_{1,i} = \mathrm{dp}_{1,i-1} + 1$
      - $\mathrm{dp}_{0,i} = \mathrm{dp}_{0,i-1}$
    - $T_i$ が`0`:
      - $i$ 文字目単独の結果も含めて $\mathrm{dp}_{0,i} = \mathrm{dp}_{0,i-1} + 1$
      - $\mathrm{dp}_{1,i} = \mathrm{dp}_{0,i-1}$
  - 解: $\sum_{i=1}^N \mathrm{dp}_{1,i}$
- タネさえわかってしまえば単なる2要素DPなのだが、漸化式を3項間にしてしまっていたり、 $i$ 文字目までの全ての部分文字列を対象にしようとして二重カウントしたりで無駄に時間を食ってしまった


## E - Trapezium
- AC（18分）
- $N \leq 2000$ より全ての2点間の全ベクトルを列挙してもOK
- 題意よりベクトルが平行ならば必ず台形を作ることができる
  - よってベクトルを適切に正規化して平行なものを同一視できればOK
- ベクトル $v = (p, q)$ に対し、以下の手順で正規化した（恐らく公式解説のものと同一手順）
    1. $p < 0$ ならば反転する（ $v \gets -v$ とする）
    2. $g = \mathrm{gcd}(p, q)$ を用いて $v' = \frac{v}{g}$ とする
        - ただしいずれかの成分が $0$ の場合は $g$ をもう一方の成分とする（要するに $(0,1)$ か $(1,0)$ に正規化されるようにする）
- あとは正規化されたベクトル $v'$ に対し同一のものの個数を $C_{v'}$ として $\sum_{v'} \begin{pmatrix} C_{v'} \\ 2 \end{pmatrix}$ を解とすればOK
  - $C_v$ の管理には`map<pair<ll, ll>, ll>`を用いればOK
- ……と思いきや、この方法では平行四辺形を二重カウントしてしまう
- 仕方ないので`map<pair<ll, ll>, map<ll, ll>>`として、正規化されたベクトル $v'$ および正規化に使った $g$ の双方をキーとして個数を管理した
  - これなら平行四辺形の個数も数えられるので重複を取り除くことができる
- 計算量は $P = \max_i \{ X_i, Y_i \}$ として一応 $O(N^2 \log N \log P)$`map`を二重に使ったので流石に計算が重く2844msもかかった
  - 4秒制限で助かったぜ……
- なお正規化する前と後でそれぞれを`map<pair<ll, ll>, ll>`で管理することでも理論的には解けるが
  - 正規化する前のベクトルの種類数が多すぎるせいか、範囲forで舐めると`TLE`してしまう
    - 先にこのアイデアを思いついていたら絶対袋小路から抜け出せなかったと思われる……運が良かった
- （公式解説）対角線が互いの中点で交わるってのは確かに平行四辺形となる条件のうちの1つだが、ベクトルに注目してしまうとこれは思いつかん！
