# [ABC404](https://atcoder.jp/contests/abc404)
- Rated参加
- EもFも解けず2000位台
  - 伸び悩んでますねぇ……

## D - Goin' to the Zoo
- AC（13分）
- 各動物の見た回数の状態数は動物ごと3通り（見てない、1回見た、2回以上見た）なので全体で $3^M \leq 3^{100}$ 通り！？と思ったが
  - そちらではなく各動物園に行く回数のパターン $3^N \leq 6 \times 10^4$ 通りを全探索すれば良いことに気づく
    - 全体計算量は $O(3^N NM)$

## E - Bowls and Beans
- 時間切れ
- 後ろから操作すればよいのには気付いたが
  - 豆の存在しうる区間で管理することを思いつかず
  - かつ、一番後ろの豆は一つ前の豆に合流さえすればよいというのも言われると確かに……となるが
    - 今の実力ではおそらく1時間悩んでもこの2つの発想は出てこない……経験が足りぬ

## F - Lost and Pound
- 時間切れ
- こちらを先に考えていたので余計にEの時間が足りなくなった
  - やることは明確にDPなので手を出してみたが明らかに難易度を読み間違えている
- 公式解説を見て自分なりに再考してみる
- 残り $t$ セットで $k$ 点を取る確率の最大値を $P(t, k)$ としてメモ化再帰で $P(T, K)$ を求めることにする
- $(c_1, c_2, \dots, c_N)$ を各ボタンを押す回数とする。ただし、
  - ${\displaystyle \sum_{i=1}^N c_i = M}$
  - 各ボタンはランダムに並び替えられるため、 $c_i$ を降順に並び替えても問題ない。よって以降 $c_1 \geq c_2 \geq \dots \geq c_N$ とする
- 各ボタンが当たる確率は毎セットごとに $1/N$ なので、以下のDP遷移式が成り立つ
$$ P(t, k) = \max_{c_1 + c_2 + \dots + c_N = M} \frac{1}{N} \sum_{i=1}^{N} P(t-1, \max \{ 0, k-c_i \} ) $$
- ただし初期値は $P(0, 0) = 1, P(0, k) = 0 (k > 0)$
- ここで $N \leq 2 \times 10^5$ に対して $M \leq 30$ であるからほとんどのボタンは押せない、すなわちほとんどの $c_i$ は $0$ になることに注目する
- $n$ を $c_i > 0$ を満たす最大の $i$ とすると、DP遷移式は以下のように書き換えられる
$$\begin{align*}
  P(t, k) &= \max_{c_1 + c_2 + \dots + c_n = M} \frac{1}{N} \left( \sum_{i=1}^{n} P(t-1, \max \{ 0, k-c_i \}) + \sum_{i=n+1}^{N} P(t-1, k) \right) \\
  &= \max_{c_1 + c_2 + \dots + c_n = M} \frac{1}{N} \left( \sum_{i=1}^{n} P(t-1, \max \{ 0, k-c_i \}) + (N - n) P(t-1, k) \right)
\end{align*}$$
- ここで、 $c_1 + c_2 + \dots + c_n = M$ に関しては $P(t, k)$ と関係ないため、前計算であり得る $(c_1, c_2, \dots, c_n)$ をすべて列挙しておくことができる 
  - ただし $n \leq N$ に注意
  - これの計算量は調べてもよくわからないが実測だと $O(M^3)$ のような気がする
- 全体計算量は $O(TKM^3)$
