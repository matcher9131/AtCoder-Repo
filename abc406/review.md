# [ABC406](https://atcoder.jp/contests/abc406) Review
- Rated参加
- Fが解けたがEが解けず1000位台止まり
  - 一応レーティングは微増
- 地味にCがちょい難しくてビビる
- 406 Not Acceptable……いよいよマニアックになってきた

## C - ~
- AC（13分）
- $P_i \neq P_{i+1}$ が任意の $i$ で成り立つため、 $2 \leq i \leq N-1$ において以下が成り立つ
  - $P_i$ が極大値 $\Leftrightarrow P_{i-1} < P_i > P_{i+1}$
  - $P_i$ が極小値 $\Leftrightarrow P_{i-1} > P_i < P_{i+1}$
- また、判断をしやすくするため以下も極値とみなす
  - $P_1 < P_2$ のときの $P_1$ （極小値）
  - $P_{N-1} < P_N$ のときの $P_N$ （極大値）
- 左から見て $j$ 番目の極大値を取るときの $i$ の値を $H_j$ とする（同様に極小値に対し $L_j$ を定める）と
  - $L_j \leq l < H_j$ および $L_{j+1} < r \leq H_{j+1}$ を満たす $l,r$ に対し、区間 $[l, r]$ はチルダ型になる
    - よって $\sum (H_j - L_j)(H_{j+1} - L_{j+1})$ が解になる

## D - Garbage Removal
- AC（7分）
- `map<行番号, その行にあるゴミの列番号の集合>` および `map<列番号, その列にあるゴミの行番号の集合>` の2つを管理しながらクエリに答えるだけ
- これCより簡単なのでは……？

## E - Popcount Sum 3
- 時間切れ
- やることはほぼ合っていたが細かいところが詰めきれなかった
  - なお終了後にその細かいところを詰めようとして1時間が溶けた模様
    - 公式解説でいうところの $s(i, j)$ と $f(i, j)$ をまとめて計算していたが、 $K-i+1 = 0$ のとき $s(i,0) = 0$ に対して $f(i, 0) \neq 0$ であることに気づいていなかったのが原因っぽい

## F - Compare Tree Weights
- AC（42分+2WA）
- 以下、頂点 $1$ を根とする
- オイラーツアーで各頂点に入った時刻 $s_v$ と出た時刻 $t_v$ を記録し、長さ $2N$ の数列 $A$ を用意して各頂点 $v$ に対し $A_{t_v}$ がその頂点の重みになるようにすると（他の項はすべて $0$ ）
  - 頂点 $v$ を根とする部分木の重みの和は ${\displaystyle \sum_{i=s_v}^{t_v} A_i}$ で求めることができる
    - これを $w_v$ とすると、クエリ2で答えるべきは $|w_u - (w_1 - w_u)|$
      - ただし $u$ は指定された辺の両端の頂点のうち根から遠い方
- $A$ をFenwick treeで管理すればクエリ1, 2ともに $O(\log N)$ で処理できるので全体計算量は $O(Q\ log N)$ で十分に間に合う
- はじめ難しく考えすぎて`lazy_segtree`で区間 $[s_v, t_v]$ に加算などよくわからないことをやっていた
- 案の定、頂点と時刻を取り違えて1敗
