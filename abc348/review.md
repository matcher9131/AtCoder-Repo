# [ABC348](https://atcoder.jp/contests/abc348) Review
- バーチャル参加
- Dが解けないというまさかの事態
  - Eが解けたのでかろうじて1600位台

## D - Medicines on Grid
- 時間切れ
- 薬のあるマスのみを頂点とするグラフで探索すれば良いことには気づくも
  - 薬 $i$ を使った後他の薬を使わずに薬 $j$ にたどり着ける場合にのみ辺を張れば単にDFSで済むことに気がつけなかった
  - BFSを $N$ 回繰り返すというのもやや盲点
    - 計算量を考えれば余裕で間に合うのだからちゃんと考慮すべき

## E - Minimize Sum of Distances
- AC（50分+1WA）
- 謎に木の重心を持ち出してサンプルと答えが合わず……でほぼ倍の時間がかかってしまった
  - （公式解説）と思ったが、重み付き頂点にすれば重心で間違いなかったのか……
- 愚直にやると間に合わないので差分を使ってどうにかするパターン
- 以降、頂点 $1$ を根とする根付き木として考える
- ある頂点 $u$ に対し、その親となる頂点を $p$ 、自身を含む子孫頂点の集合を $D$ とする。このとき $f(u)$ と $f(p)$ の関係について考える
  - $d(u, i)$ に関して
    - $i \in D$ ならば $d(u, i) = d(p, i) - 1$
    - $i \notin D$ ならば $d(u, i) = d(p, i) + 1$
  - よって以下が成り立つ
$$ \begin{align*}
    f(u) &= \sum_{i \in D} C_i (d(p, i) - 1) + \sum_{i \notin D} C_i (d(p, i) + 1) \\
    &= \sum_{i \in D} C_i d(p, i) - \sum_{i \in D} C_i + \sum_{i \notin D} C_i \\
    &= f(p) - \sum_{i \in D} C_i + \left( \sum_{i=1}^n C_i - \sum_{i \in D} C_i \right)
\end{align*} $$
- よってあらかじめDFSで $f(1)$ および「その頂点を含む子孫頂点の $C_i$ の和」を求めておけば、再びDFSですべての $f(x)$ が合計 $O(N)$ で求められる
  - 後者は帰りがけ順で自身および子の値を足し合わせることで求まる（部分木のサイズを求めるのと同様）
- $f(x)$ を`int`にしてしまい1敗
  - ほとんど`WA`だったから何事かと思ったぜ！
