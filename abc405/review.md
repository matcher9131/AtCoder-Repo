# [ABC405](https://atcoder.jp/contests/abc405) Review
- Rated参加
- `WA`もなくFまでクリアし700位
  - ここのところイマイチだったのでこれは大きな躍進
  - 10分ほど残ったのでGが解けないかと見てみたがワンチャンスもなかった模様
- 今回は数学的考察を使う問題が多かった気がする
- ~~ステータスコード405に関する問題が出るかと思ったがそうではなかった~~
  - ~~というか405 Method Not Allowedとか見たことないぞ……~~

## C - Sum of Product
- AC（2分）
- 数学的考察、というか大学入試数学でもたまに見る定石一発問題。以上！
$$ \left( \sum_{i=1}^N A_i \right)^2 = \sum_{i=1}^N A_i^2 + 2\sum_{i=1}^{N-1} \sum_{j=i+1}^N A_i A_j$$
- 後で見返しても爆速で解いてて草

## D - Escape Route
- AC（13分）
- 非常口を1つずつ根にしてBFSをしようとしたが、非常口が多いと`TLE`だよなぁと思い手が止まる
- そしてしばらく後に最初に`queue`に入れる頂点は1つだけでなくとも問題なくBFSできることに気づき、すべての非常口をぶち込む
  - `dist`を記録する代わりに $S$ を直接書き換えることで訪れたマスを記録できて楽

## E - Fruit Lineup
- AC（18分）
- DPかと思ったが高校数学の場合の数の知識のみでいけるのではと考え直す
  - まずオレンジ以外を並べ、そこにオレンジをねじ込む方針で
- $0 \leq i \leq C$ として、最も左にあるブドウより左にあるバナナの個数が $i$ となるオレンジ以外の並べ方の場合の数を $P_i$ とすると
  - 左から順に $A$ 個のリンゴ、 $i$ 個のバナナ、 $1$ 個のブドウは固定なので、残るバナナ $C - i$ 個とブドウ $D-1$ 個の並び替えであり、$ P_i = \begin{pmatrix} C + D - i - 1 \\ D-1 \end{pmatrix}$
- この場合においてオレンジの入れ方の場合の数 $Q_i$ を考える
  - オレンジが入れられるのは $A+i$ 個のリンゴ＆バナナの間および両端の合計 $A+i+1$ 箇所
    - むしろ逆に $B$ 個のオレンジを並べておいて、そこに $A+i$ 個のリンゴ＆バナナを順に仕切り代わりに入れるパターンと考えれば $Q_i = \begin{pmatrix} B+A+i \\ B \end{pmatrix}$
- $i$ が異なれば明らかに排反なので、解は ${\displaystyle \sum_{i=0}^C P_i Q_i}$

## F - Chord Crossing
- AC（49分）
- 色々悩んだ挙げ句に以下の手順を思いつく
    1. 区間 $[A_i, B_i]$ および区間 $[C_j, D_j]$ をそれぞれ $A_i, C_j$ の昇順でソートする
    2. $j = 1, 2, \dots, Q$ の順に以下を行う
        - $A_i < C_j$ を満たすすべての $i$ に対し、$C_j \leq B_i \leq D_j$ となる $i$ の個数をカウントする
    3. 区間 $[A_i, B_i]$ および区間 $[C_j, D_j]$ をそれぞれ $B_i, D_j$ の昇順でソートする
    4. $j = 1, 2, \dots, Q$ の順に以下を行う
        - $B_i > D_j$ を満たすすべての $i$ に対し、$C_j \leq A_i \leq D_j$ となる $i$ の個数をカウントする
    5. 2.および4.でカウントしたものを足し合わせてクエリの解とする
- 手順2. および4. においては $j$ に応じて $i$ を増やしながらSegment Treeで $B_i = x$ や $A_i = x$ となる個数を増やす/減らすことで毎度1から計算する手間を省く
  - 計算量は $O(M \log M + Q \log Q + (M+Q) \log N)$
- $[C_j, D_j]$ より左側と右側を別個にソートからやり直して数えればいいと気づくのにかなりの時間を要した
  - 区間系問題はやることが決まっていないから苦労するぜ……
- （公式解説）包含関係にある区間をグラフ（木）にする……どこかで使いそうな知識だな
