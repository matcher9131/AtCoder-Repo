# [ABC333](https://atcoder.jp/contests/abc333) Review
- バーチャル参加
- Eまで解けて1150位相当


## C - Repunit Trio
- AC（18分）
- $A_i$ を $i$ 番目に小さいレピュニットとして、 $i \leq j \leq k$ となるような $(i, j, k)$ に対して $A_i + A_j + A_k$ を計算すればよいのだが
  - 計算量的に効率良く $(i, j, k)$ を列挙する方法を思いつくのに手間取ってしまった
- 結果的に以下のような探索順を取った
  - $i = j = k$ のとき
    - $i \gets 0, j \gets 0, k \gets k+1$ とする
  - $i = j < k$ のとき
    - $i \gets 0, j \gets j+1$ とする
  - $i < j$ のとき
    - $i \gets i+1$ とする
- （公式解説）↑で問題ないのだが、「条件を満たす数は $1$ が0個以上、 $2$ が0個以上、 $3$ が1個以上並んでいる」という視点は自分にはなかったのでメモっておく
- DはもとよりEよりも時間かかってるやんけ！

## D - Erase Leaves 
- AC（8分）
- 頂点 $1$ が葉（＝頂点 $1$ の次数が $1$ ）なら解は $1$
- そうでないとき
  - 木を $1$ を根とする根付き木とする
  - ある頂点 $i$ に対し、その頂点を根とする部分木のサイズを $S_i$ とする
  - 頂点 $1$ の子からなる集合を $C$ とする
  - このとき、解は $\sum_{i \in C} S_i - \max_{i \in C} S_i$
- 個人的にはCより遥かに楽だったんだが……

## E - Takahashi Quest
- AC（13分）
- 逆順に処理すれば良さそうだな……と思いついたのでそれを実行してみる
  - $C_i$ をまだ倒せていないタイプ $i$ のモンスターの数とする
  - クエリを順方向に処理する際に、そのクエリを処理する直前のポーションの所持数として $k = 0$ に初期化する
    - クエリを逆順に処理する都合上、入手と使用が逆になる点に留意
  - クエリを逆順にして以下の手順を行う
    - $t_i = 1$ のとき
      - $C_{x_i} > 0$ のとき、そのポーションを拾う
        - すなわち $C_{x_i} \gets C_{x_i} - 1, k \gets k - 1$ とする
      - $C_{x_i} = 0$ のとき、そのポーションを拾わない（何もしない）
    - $t_i = 2$ のとき
      - $C_{x_i} \gets C_{x_i} + 1, k \gets k + 1$ とする
  - なお↑のクエリ処理の際に $k$ が最大値を更新する場合、それを $K$ としておく
  - すべてのクエリを処理した後に $C_i > 0$ となる $i$ が存在する場合、倒せていないモンスターが存在するので解は`-1`
- ↑のようにした場合、あるモンスターを倒すために必要なポーションはできる限り直前で拾うことになるので、必然的に $K$ は $K_{\min}$ になる

## F - Bomb Game 2
- 時間切れ
- 形式的冪級数でやろうとして頓挫
- 概ね公式解説と同じだが後学のために考え方を記しておく
- $1/2$ の確率で列から取り除くのではなく、当たり・ハズレを配って列の最後尾に行ってもらうようにすると
  - 「人 $i$ が最後まで残る」事象は「少なくとも1回以上当たりを引く最後の人が人 $i$ になる」事象と言い換えられる
- $k$ 巡目に「少なくとも1回以上当たりを引く最後の人が人 $i$ になる」確率を $P_{i, k}$ とおくと、 
  - $P_{i, k} = 2^{-k} (1 - 2^{-k})^{i-1} (1-2^{-k+1})^{N-i}$ であり、人 $i$ に対する解は $\sum_{k=1}^{\infty} P_{i,k}$
- $f_i(x) = \frac{1}{2}x \left( 1 - \frac{1}{2}x \right)^{i-1} \left( 1 - x \right)^{N-i}$ とおくと
  - 人 $i$ に対する解は $\sum_{k=1}^{\infty} f_i(2^{-k+1})$
- ここで $f_i(x)$ は $N$ 次式であることから、 $i$ 次の係数を $a_i$ とおくと（ $f_i$ の定義より $a_0 = 0$ に留意）

$$\begin{align*}
    \sum_{k=1}^{\infty} f_i(2^{-k+1}) &= f_i(1) + f_i \left( \frac{1}{2} \right) + f_i \left( \frac{1}{4} \right) + \dots \\
    &= a_N \cdot 2^0 + a_{N-1} \cdot 2^0 + \dots + a_1 \cdot 2^0 \\
    &+ a_N \cdot 2^{-N} + a_{N-1} \cdot 2^{-(N-1)} + \dots + a_1 \cdot 2^{-1} \\
    &+ a_N \cdot 2^{-2 \cdot N} + a_{N-1} \cdot 2^{-2(N-1)} + \dots + a_1 \cdot 2^{-2 \cdot 1} \\
    &+ \dots \\
    &= a_N \left( 2^0 + 2^{-N} + 2^{-2N} + \dots \right) + a_{N-1} \left( 2^0 + 2^{-(N-1)} + 2^{-2(N-1)} + \dots \right) + \dots \\
    &= a_N \cdot \frac{1}{1 - 2^{-N}} + a_{N-1} \cdot \frac{1}{1 - 2^{-(N-1)}} + \dots + a_1 \cdot \frac{1}{1 - 2^{-1}} \\
    &= \sum_{k=1}^{N} \frac{a_k}{1-2^{-k}}
\end{align*}$$

- よって $f_i$ の各次の係数がわかっていれば $O(N)$ で人 $i$ に対する解が求まる
- あとは $f_{i+1}(x) = \frac{1 - \frac{1}{2}x}{1-x} f_i(x)$ を用いて $f$ を順次更新していけば全体計算量 $O(N^2)$ で求まる
  - 例によって $1-x$ で割る操作は代わりに累積和を取ればOK
