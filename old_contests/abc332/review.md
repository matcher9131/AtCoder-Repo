# [ABC332](https://atcoder.jp/contests/abc332) Review
- バーチャル参加
- D,Eに合計1時間を費やしたのに解けずじまいの絶望の中、意地でFを解く
  - 先にFを解いていれば……と思いつつ順位表を見るとまさかの650位相当で草
    - ってEが青色なんかい！

## D - Swapping Puzzle
- 時間切れ
- 行・列ごとに（多重）集合として一致するものがなければそもそも無理
  - 一致するものがあれば何行目・何列目に移動させるべきかを記録してから操作回数を求めたが
    - 当然のごとく`WA`を喰らう
- （公式解説）場面数 $(5!)^2 = 14400$ だから全探索可能、かつ高々25要素のグリッドだからそのままキーにしてBFS……
  - そんな無茶なと思いつつもこれが普通にできるわな……なぜ思いつかなかった

## E - Swapping Puzzle
- 時間切れ
- 袋 $i$ に入っているグッズの重さの和を $S_i$ と表すとして $(S_i - \overline{x})^2$ の降順をキーとした優先度付きキューに各袋をぶち込み、$W_i$ の降順で1つずつグッズを袋に入れる（ただし $S_i > \overline{x}$ となった袋は優先度付きキューには入れない）としたが
  - やはりこちらも当然の`WA`
- （公式解説）bit DPは真っ先に疑うべきだった……というかなぜ疑わなかったのかがわからん……
- 普通に使えそうなのでメモ：
  - ビット集合における部分集合の列挙
    - ビット集合 $x$ に対し、以下のようにすれば部分集合 $y$ をすべて列挙できる
        1. 初期値 $y = x$
        2. $y \gets (y-1) \ \mathrm{AND} \ x$ で更新

## F - Random Update Query
- AC（19分）
- ありがとうLazy segment tree……
- クエリごとに区間 $[L_i ,R_i]$ に対して「 $(1 - \frac{1}{R_i - L_i + 1})$ 倍して $\frac{p}{R_i - L_i + 1}$ を足す」が繰り返される
  - すなわち「 $a$ 倍して $b$ を足す」という操作がモノイド作用の要件を満たしていれば`atcoder::lazy_segtree`にぶん投げてOK
- 以下、数を表す変数はすべて非負とする
- まずモノイド $(S, \cdot)$ に対して
  - 適当にRMQとかにしておく
- 次に「 $a$ 倍して $b$ を足す」という写像集合 $F$ に対して
  - 「 $1$ 倍して $0$ を足す」写像 $f_e$ に対し
    - $\forall x \in S, f_e(x) = x$ を満たす（恒等写像が $F$ に含まれる）
  - 「 $a_1$ 倍して $b_1$ を足す」写像 $f_1$ および「 $a_2$ 倍して $b_2$ を足す」写像 $f_2$ に対して
    - $\forall x \in S, f_2(f_1(x)) = a_1a_2x + a_2b_1 + b_2 \in S$ となるので、 $f_2 \circ f_1$ は「 $a_1a_2$ 倍して $a_2b_1 + b_2$ を足す」と言い換えられる。
      - すなわち $\forall f_1, f_2 \in F, f_2 \circ f_1 \in F$ である（ $F$ は写像の合成について閉じている）
  - 「 $a$ 倍して $b$ を足す」写像 $f$ および $x,y \in S$ に対し、
    - $f(x \cdot y) = f(\max \{ x, y\}) = a \max \{ x, y\} + b$
    - $f(x) \cdot f(y) = (ax + b) \cdot (ay + b) = \max \{ ax + b, ay + b \} = a \max \{ x, y\} + b \ (\because a > 0)$
    - すなわち $f(x \cdot y) = f(x) \cdot f(y)$ である（ $F$ は $S$ に対し準同型性を持つ）
- よって「 $a$ 倍して $b$ を足す」操作はモノイド作用として使える
