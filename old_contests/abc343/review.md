# [ABC343](https://atcoder.jp/contests/abc343) Review
- バーチャル参加
- Fまで突破してまさかの300位相当
  - 青色のEを無傷で突破できたおかげか
- Gもやるべきことはわかったが流石にいろいろと足りなかった
- $7^3 = 343$ は常識です（）

## D - Diversity of Scores
- AC（9分）
- `vector`で各選手の得点を管理しつつ`map<ll, int>`で点数と人数のセットを管理するだけ
- まさかDが茶色とは思わなんだ

## E - 7x7x7
- AC（38分）
- 明らかに $(a_1, b_1, c_1) = (0, 0, 0)$ として問題ない
  - さらに $0 \leq a_2, b_2, c_2 \leq 7$ および $-7 \leq a_3, b_3, c_3 \leq 7$ としても問題ない
    - $a_3, b_3, c_3$ に関してはもっと適切な範囲の絞り込みがありそうだが、下手に絞って`WA`が出てもアホらしい上に計算量的には十分絞り込んでいるのでこのままで
- 3つの立方体を順に $U_1, U_2, U_3$ 、領域 $S$ の体積を $f(S)$ と表すことにすると、以下が成り立てばOK
  - $V_3 = f(U_1 \cap U_2 \cap U_3)$
  - $V_2 = f(U_1 \cap U_2) + f(U_2 \cap U_3) + f(U_3 \cap U_1) - 3f(U_1 \cap U_2 \cap U_3)$
  - $V_1 = f(U_1) + f(U_2) + f(U_3) - 2f(U_1 \cap U_2) - 2f(U_2 \cap U_3) - 2f(U_3 \cap U_1) + 3f(U_1 \cap U_2 \cap U_3)$
- あとは各 $(a_2, b_2, c_2, a_3, b_3, c_3)$ に対して↑を判断すればよい
  - 組み合わせは $8^3 \cdot 15^3 \approx 1.7 \times 10^6$ 通りなので余裕で間に合う
- 立体の交差判定に引数12個の関数を定義するという超絶脳筋仕様
  - だが案外こういった問題の難易度って高い気がする

## F - Second Largest Query
- AC（13分）
- `(最大値, 最大値となる項の個数, 2番目に大きい値, 2番目に大きい値となる項の個数)`を`segtree`に載せるだけ
  - とはいえ`prod`の計算コストがそこそこ重く、ほとんどのテストケースで1000ms前後を必要としておりなかなかスリリングだった
- 計算量は $O(\max \{ Q \log N, N \log N \})$

## G - Compress Strings
- 時間切れ
- $S_i$ が $S_j$ の部分文字列となる場合、 $S_i$ が有っても無くても解は変わらないため削除してよい
  - ただし勿論ながら同じ文字列が複数ある場合は1つは残さなければならない
  - 以下残った文字列の数を $N'$ とする
- 頂点数 $N'$ の有向グラフを考え、任意の頂点から任意の頂点へ辺を張る。ただし以下のようにコストを定める
  - suffixが $S_i$ である文字列 $X$ の末尾に何文字か加えてsuffixが $S_j$ になる文字列 $Y$ を作るとき、 $|Y| - |X|$ の最小値を辺 $E_{i,j}$ のコストとする
- このとき解はこのグラフの最小コストのハミルトン路
- $E_{i,j}$ は $S_i$ のsuffixかつ $S_j$ のprefixとなる最長の文字列の長さを $k$ として $|S_j| - k$ で求まる
- ここまではわかったが実現するツールが足りなかった
- ここでZ algorithmが役立つ
  - 文字列 $T$ が文字列 $S$ の部分文字列として含まれるかどうかを $O(|S| + |T|)$ で判断するアルゴリズムだが、今回の問題でも使える。詳細は以下の通り
    - 文字列 $S_j$ 、`~`、 $S_i$ をこの順に連結した文字列を $T$ とする
    - $T$ に対してZ arrayを計算し、これを $Z$ とする
    - $1 \leq k \leq |S_i|$ に対し、 $Z$ の後ろから $k$ 番目(1-indexed)の項が $k$ に一致するような最大の $k$ を得る（存在しない場合は $k=0$ ）
    - $E_{i,j} = |S_j| - k$ である
- あとは「訪れた頂点の集合」および「最後に訪れた頂点」をキーとするbit DPに任せればOK
- **Z arrayを求めるコードはAtCoder Libraryにある（超重要）**
  - 知らずにZ algorithmを用いる問題を過去にやってような気がするなぁ……
- なお区切り文字`~`を使わずに $S_i$ の後ろに $S_i$ 以外をすべてくっつけてZ arrayを求めることでさらに計算量を減らせる模様
  - $k$ を求める際には↑の「 $k$ に一致」を「 $k$ 以上」に変えれば問題ないらしい