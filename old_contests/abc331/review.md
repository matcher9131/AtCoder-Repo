# [ABC331](https://atcoder.jp/contests/abc331) Review
- バーチャル参加
- イージーミスを連発しながらもEまで到達で1050位くらい
  - ABC414と同日なのだがABC414のほうもイージーミスを連発しそうで怖い


## D - Tile Pattern
- AC（14分）
- $(A, B)$ を左上隅、 $(C, D)$ を右下隅とする長方形領域に含まれる黒マスの個数を $f(A, B, C, D)$ とおく
- $f(0, 0, C, D)$ について考える
  - $C, D$ を $N$ で割った商をそれぞれ $q_C, q_D$ 、余りをそれぞれ $r_C, r_D$ とすると、長方形領域は以下に分けられる
    - $P$ の完全体が $q_Cq_D$ 個
    - $P$ の左から $r_D$ 列からなる部分が $q_C$ 個
    - $P$ の上から $r_C$ 行からなる部分が $q_D$ 個
    - $P$ の上から $r_C$ 行かつ左から $r_D$ 行からなる部分が $1$ 個
  - よって事前に $P$ の左上から $i$ 行 $j$ 列の部分における黒マスの個数を2次元累積和で求めておけば、解は $O(1)$ で求まる
- 2次元累積和の要領で考えると $f(A, B, C, D) = f(0, 0, C, D) - f(0, 0, A-1, D) - f(0, 0, C, B-1) + f(0, 0, A-1, B-1)$ とできるので解も求まる
  - $A-1$ および $B-1$ が $-1$ になるケースに注意（事前の条件分岐で弾いておく）


## E - Set Meal
- AC（18分＋2TLE）
- 主菜および副菜をそれぞれ価格の降順でソートする
- 初期値として以下を用意する
  - $\mathrm{ans} = 0$ 
  - 価格の合計の降順でソートする優先度付きキュー
  - 空集合 $S$
- キューに初期値として $(0,0)$ を入れ、空になるまで以下を繰り返す
  - キューの先頭から1個取り出す。以下これが $(i, j)$ であるとする
  - $S$ に $(i,j)$ を追加する
  - それが許される組み合わせであり、価格の合計が $\mathrm{ans}$ よりも大きければ $\mathrm{ans}$ を更新する
  - それが許されない組み合わせならば
    - $i < N$ かつ $(i+1, j) \notin S$ なら $(i+1, j)$ をキューに入れる
    - $j < M$ かつ $(i, j+1) \notin S$ なら $(i, j+1)$ をキューに入れる
- 解として $\mathrm{ans}$ を出力すればOK
- 探索済みかどうかを判断する $S$ を用意し忘れて1敗
  - さらに $S$ を用意したのに $(i,j)$ を追加するのを忘れてもう1敗
    - このグダグダっぷりである
- （公式解説）主菜 $i$ を固定し副菜を検索する方法のほうが簡単でよかったか……？


## F - Palindrome Query
- 時間切れ後に提出
- メモ：ローリングハッシュ
  - 適当な正整数 $B$ およびそれより大きく互いに素な正整数 $M$ を用意する
  - 文字列 $S$ を表す数列 $C = (C_1, C_2, \dots, C_N)$ に対して $H(C) = \left( \sum_{i=1}^{N} B^{n-1} C_i \right) \bmod M$ をローリングハッシュと呼ぶ
  - 文字列 $S, T$ に対し、 $H(S + T) = \left( B^{|T|} H(S) + H(T) \right) \bmod M$ とできるため、文字列の連結や部分文字列の計算が素早くできる
- 今回はローリングハッシュをSegment treeに載せたい
  - `(文字列のハッシュ値, 文字列の長さ)`をモノイドとみなせるのでこれを使えばOK
    - 単位元は`(0, 0)`
- 回文かどうかは正順と逆順のSegment treeを用意して両者のハッシュが一致するかどうかを見ればOK
- ハッシュゆえ衝突する確率がそこそこある（公式解説曰く $10^{-3}$ 程度）が、複数の $(B, M)$ を用意すれば問題ない
  - 今回は幸運にも1組で`AC`が出てしまった
