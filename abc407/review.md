# [ABC407](https://atcoder.jp/contests/abc407/tasks/abc407_a) Review
- Rated参加
- Eが早く解けていれば……というのが恒例の展開になってきた
  - 一応1000位弱でレーティングは微増だがこれで満足はしたくない
- ステータスコードは流石にもういいか、と思った矢先に
  - AのタイトルがAp**proxi**mationなのは407 **Proxy** Authentication Requiredだからかもしれないと気づく

## D - Domino Covering XOR
- AC（14分）
- $HW \leq 20$ なので各マスにドミノが置かれているかどうかのビット全探索が可能
- ドミノの置き方に関係なくどのマスがドミノで埋まっているかのみで値が決まるのでメモしながら探索することで計算量を減らせる
  - 全体の計算量は $O(HW2^{HW})$

## E - Most Valuable Parentheses
- AC（48分）
- 参考：[括弧列 – 37zigenのHP](https://37zigen.com/parenthesis/)
- ↑を参考にしたは良いものの書いてあることを理解して試行錯誤するのにかなりの時間を要してしまった
- $i = 1, 2, \dots, N$ の順に以下を行う
  - $1 \leq j \leq 2i-1$ 文字目からまだ`(`として選んでいないもののうち、 $A_j$ が最大となるものを選ぶ
- 結局のところ2文字につき1文字は`(`にする必要があり、 $1$ 文字目は必ず`(`で $2N$ 文字目は`)`になることからこれでいけるっぽい
  - $i$ 回目の選択時に`(`が $i$ 文字、`)`が $i-1$ 文字で括弧レベルが負になることがないため常に正規の括弧列になる

## F - Sums of Sliding Window Maximum
- 時間切れ
- （公式解説） $L_i, R_i$ に相当するものは考えたが……なんぞこれは
- メモ：形式的冪級数
  - 参考：[形式的冪級数に入門する 2023](https://qiita.com/seiryu_daisuke/items/fb6e41f3359bbeb8e21f)
  - 数列 $A$ に対し母関数 $f(A) = {\displaystyle \sum_{i=0}^{\infty} A_i x^i}$ を考える
  - 母関数どうしを掛けることで組み合わせの数え上げに対応させられる
    - 例： $f(A)f(B)$ の $x^k$ の係数は数列 $A,B$ から1項ずつ選んでその和を $k$ にする場合の数と等しい
  - 母関数に ${\displaystyle \sum_{i=0}^{\infty} x^i}$ を掛けると $A$ の累積和を表す母関数になる
    - なお $|x| < 1$ とみなして ${\displaystyle \sum_{i=0}^{\infty} x^i = \frac{1}{1-x}}$ とすることができる
    - さらに[二項級数](https://ja.wikipedia.org/wiki/%E4%BA%8C%E9%A0%85%E7%B4%9A%E6%95%B0)を用いて ${\displaystyle \frac{1}{(1-x)^k} = \sum_{i=0}^{\infty} \begin{pmatrix} k + i - 1 \\ i \end{pmatrix} x^i }$ とすることもできる（ $k$ が大きいときに有用）
- で、この問題においてどう活かすか
- 例えば $A = (5, 2, 4, 1, 3)$ の場合、 $4$ に関して解に寄与するのは
  - $k=1$ のとき $(4)$
  - $k=2$ のとき $(2,4), (4,1)$
  - $k=3$ のとき $(2,4,1), (4,1,3)$
  - $k=4$ のとき $(2,4,1,3)$
- これを $0 \leq l \leq L_3 = 1$ および $0 \leq r \leq R_3 = 2$ から $(l,r)$ の組を選んでいると考えると、
  - $k=1$ のとき $(l,r) = (0,0)$
  - $k=2$ のとき $(l,r) = (1,0), (0,1)$
  - $k=3$ のとき $(l,r) = (1,1), (0,2)$
  - $k=4$ のとき $(l,r) = (1,2)$
- すなわち $k = l+r+1$ となるような組み合わせの数え上げなので、 $A_i$ が選ばれる回数は ${\displaystyle \left( \sum_{j=0}^{L_i} x^j \right) \left( \sum_{j=0}^{R_i} x^j \right)}$ の $x^{k-1}$ の係数と等しい
  - よって $k$ に対する解は ${\displaystyle f(A) = \sum_{i=1}^{N} \left( \sum_{j=0}^{L_i} x^j \right) \left( \sum_{j=0}^{R_i} x^j \right)} A_i$ の $x^{k-1}$ の係数
- ここで ${\displaystyle f(A) = \sum_{i=1}^{N} \frac{(1-x^{L_i + 1})(1-x^{R_i + 1})}{(1-x)^2} A_i = \frac{1}{(1-x)^2} \sum_{i=1}^{N} \left( A_i - A_i x^{L_i + 1} - A_i x^{R_i + 1} + A_i x^{L_i + R_i + 2} \right) }$ と変形できる
  - シグマ部分に関してはすべて $0$ で初期化された数列に対して $i = 1, 2, \dots, N$ の順に以下を行ってできた数列 $B$ を表す母関数に等しい
    - $B_0$ に $A_i$ を加える
    - $B_{L_i + 1}$ から $A_i$ を引く
    - $B_{R_i + 1}$ から $A_i$ を引く
    - $B_{L_i + R_i + 2}$ に $A_i$ を加える
  - $\dfrac{1}{(1-x)^2}$ に関しては累積和を2回取ることに対応する
- よって上記手順で $B$ をつくり、その累積和を2回とったものの $k-1$ 番目の項が $k$ に対する解となる
