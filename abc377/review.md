# [ABC377](https://atcoder.jp/contests/abc377) Review
- バーチャル参加
- またオーバーフローで無駄にWAをやらかす
  - 少しでも怪しければ`long long`で受けろ！
- だから水色問題をくれよ…

## D - Many Segments 2
- AC
- 区間 $[l, r]$ が区間 $[L_i, R_i]$ を完全に含む条件は $l \leq L_i$ かつ $R_i \leq r$
  - すなわち区間 $[l, r]$ が区間 $[L_i, R_i]$ を完全に含まない条件はこの否定の $L_i < l$ または $r < R_i$
- よって $l$ を固定したとき
  - 区間を $L_i < l$ を満たすものとそうでないものに分けると、
    - 前者は任意の $r \geq l$ に対して条件を満たす
    - 後者はすべての $i$ に対し $r < R_i$ となればよい
  - 要するに $l \leq L_i$ を満たすすべての区間における $R_i$ の最小値を $R_m$ としたとき、 $r < R_m$ が $r$ の満たすべき条件となる
- ここで $l$ を $1$ から順に大きくしていくことを考える
  - 一度 $L_i < l$ を満たした区間 $i$ は $l$ が大きくなってもそのままであることから、`++l`したときに新たに $L_i < l$ を満たす区間があるかを調べ、もしあればその区間を除外し、残りの区間で $R_m$ を探せばよい
    - $L_i$ と $R_i$ をそれぞれ二分木などで管理することで↑の各操作が高々 $O(\log M)$ でできる
      - $L_i$ は`priority_queue`、 $R_i$ は`set`で実装した
- 全体計算量は $O(M \log M)$

## F - Avoid Queen Attack
- 時間切れののち解説を見ずにAC
- $N \leq 10^9$ より勿論全マス走査はNG
  - 一方で $M \leq 10^3$ より各クイーンに対する操作はかなり時間に余裕がある
- 自分の駒が置けないマスは以下の4条件 $A, B, C, D$ のうち1つ以上を満たす
  - $A:$ 同じ行にクイーンがある
  - $B:$ 同じ列にクイーンがある
  - $C:$ そのマスを $(i, j)$ として、 $a_k + b_k = i + j$ となる $k$ が存在する（右上or左下方向にクイーンがある）
  - $D:$ そのマスを $(i, j)$ として、 $a_k - b_k = i - j$ となる $k$ が存在する（右下or左上方向にクイーンがある）
- 条件 $X$ を満たすマスの個数を $n(X)$ と表記することにすると、解は $N^2 - n(A \cup B \cup C \cup D)$ であり、
  - $n(A \cup B \cup C \cup D) \\ = n(A) + n(B) + n(C) + n(D) \\ - n(A \cap B) - n(A \cap C) - n(A \cap D) - n(B \cap C) - n(B \cap D) - n(C \cap D) \\ + n(A \cap B \cap C) + n(A \cap B \cap D) + n(A \cap C \cap D) + n(B \cap C \cap D) \\ - n(A \cap B \cap C \cap D)$
  - よって↑の各項をカウントすればOK
- 各クイーンの $a_k$ からなる集合 $P$ 、 $b_k$ からなる集合 $Q$ 、 $a_k + b_k$ からなる集合 $R$ 、 $a_k - b_k$ からなる集合 $S$ を用意すると（それぞれ重複する数字は1つしか入らない）
  - $n(A), n(B), n(A \cap B):$ 単純な計算（ $O(1)$ ）で求まる
  - $n(C), n(D):$ 各クイーンごとに座標から $C, D$ を満たすマス数がわかり、かつそれらは排反なので $O(|R|)$ や $O(|S|)$ で求まる
  - $n(A \cap C):$ 各 $p \in P, r \in R$ に対して $i = p, i + j = r$ の解 $(i, j)$ は条件 $A, C$ の双方を満たすマスの座標となる
    - よって $1 \leq j = r - p \leq N$ が成り立つかどうかを調べればよいので、 $O(|P||R|)$ で求まる
    - $n(A \cap D), n(B \cap C), n(B \cap D)$ もこれと同様
  - $n(C \cap D):$ 各 $r \in R, s \in S$ に対して $i + j = r, i - j = s$ の解 $(i, j)$ は条件 $C, D$ の双方を満たすマスの座標となる
    - $i = \frac{r + s}{2}, j = \frac{r - s}{2}$ より、$r, s$ の偶奇が一致してかつ $1 \leq \frac{r + s}{2}, \frac{r - s}{2} \leq N$ が成り立つかどうかを調べればよいので、 $O(|R||S|)$ で求まる
  - $n(A \cap B \cap C):$ $n(A \cap C)$ を求める際に $j \in Q$ を満たすかどうかを確認するだけでOKなので $O(|P||R|)$ で求まる
    - $n(A \cap B \cap D), n(A \cap C \cap D), n(B \cap C \cap D)$ も同様
  - $n(A \cap B \cap C \cap D):$ $n(A \cap C)$ を求める際に $j \in Q, i - j \in S$ を満たすかどうかを確認するだけでOKなので $O(|P||R|)$ で求まる
- 以上により、 $|P|, |Q|, |R|, |S| \leq M$ であるから全体でも $O(M^2)$ で求まる
  - なおなぜか`set`を使ったため計算量が $O(M^2(\log M)^2)$ になってしまっている（それでも十分に間に合うが）
- やることは単純だが実装とデバッグする時間がとてもじゃないが足りねぇよ…
- （公式解説）そりゃもう少しマシな数え方はあるわなぁ…
  - しかし大まかな方針は合っていた模様
