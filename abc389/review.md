# [ABC389](https://atcoder.jp/contests/abc389) Review
- Rated参加
  - 実に1年3ヶ月ぶりのRated
- Fがギリギリ間に合わず…
  - ジャッジ時間含めあと2分あれば！
  - 確実にCで変数衝突でもたついたせい
- 今回二分探索多くない？

## C - Snake Queue
- AC
- クエリタイプ2でもヘビが抜けないようにして考える
- $i$ 番目に追加されるヘビの頭の座標を $A_i$ 、クエリタイプ2で抜けているはずのヘビの数を $r$ とすれば
  - クエリタイプ3で $A_{r + k} - A_{r + 1}$ を出力すればよい

## D - Squares in Circle
- AC
- 各正方形は $(x + 0.5, y + 0.5), (x - 0.5, y + 0.5), (x - 0.5, y - 0.5), (x + 0.5, y - 0.5)$ を頂点に持つとし、円の中心は原点とする
- 第1象限にある正方形が円に内包される条件は、原点と点 $(x + 0.5, y + 0.5)$ の距離が $R$ 以下といえる
  - このうち中心座標が $y = y_1 > 0$ である正方形の個数を考えたい。中心の $x$ 座標に関して、
    - 明らかに $x \geq R$ となる正方形は円に内包されない
    - ある $x_0$ が存在して $1 \leq x \leq x_0$ である正方形はすべて円に内包される
      - すなわち、単調性があるので区間 $[1, R]$ で二分探索で $x_0$ を見つけることができる
- 対称性より第2・第3・第4象限にあって円に内包される正方形の個数はそれぞれ第1象限のものの個数に等しい
- 軸上にある正方形に関して
  - 先ほどと同じ考え方で $y_0 = 0$ とすれば、 $x$ 軸の正の部分に中心が存在する正方形の個数を調べられる
  - 対称性より $x$ 軸の負の部分、 $y$ 軸の正の部分、 $y$ 軸の負の部分に中心が存在する正方形の個数も↑に等しい
- 最後に原点が中心となる正方形は $R \geq 1$ より必ず円に内包される
- 計算量は $O(R \log R)$
- （公式解説）なるほど尺取法か…

## E - Square Price
- TLEからの時間切れ
- $i$ 番目の商品の $k$ 個目の値段が $(2k - 1)P_i$ 円とわかるので、`priority_queue`を使って安い方から1個ずつ貪欲に買おうとするも勿論`TLE`
- （公式解説） $x$ 円以下をすべて買って、 $x+1$ 円をいくつか買うような $x$ を二分探索…これは思いつかん



## F - Rated Range
- 終了後に提出
- クエリを1個ずつ処理すると $O(NQ)$ となり確実に`TLE`
  - 並列に処理できるので一括で処理する方針で
- 各クエリではじめに与えられるレーティング $X$ について、これを昇順で並び替えると、各コンテストで更新される範囲は必ず1つの連続した部分になる
  - すなわち区間に一括で`+1`できればよいので、Lazy segment treeの出番
- ただしどこからどこまでを`+1`すればよいかについては直接的にはわからない
  - しかし各レーティングは何度コンテストを受けても昇順のままなので、区間の左端と右端をそれぞれ二分探索で求めることができる
    - Lazy segment treeの1要素を取得するたびに計算量 $O(\log Q)$ なので、この二分探索の計算量は $O((\log Q)^2)$
- 全体計算量はクエリのソート、最終レーティングの取得も考えて $O(N(\log Q)^2 + 2Q \log Q)$
- （公式解説）`max_right`で行けたのか…わざわざ自分で二分探索を書いてしまった
